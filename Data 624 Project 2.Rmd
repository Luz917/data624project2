---
title: "Data 624 Project 2"
author: "Maryluz Cruz, Bill Stepniak, Sherranette Tinapunan"
date: "5/11/2021"
output:
  html_document:
    df_print: paged
    theme: cerulean
    #code_folding: hide
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(mice)
library(caret)
library(e1071)
library(psych)
library(DataExplorer)
library(RANN)
library(MASS)
library(ggplot2)
library(elasticnet)
library(randomForest)
library(skimr)
library(DataExplorer)
```


## 1. Problem Statement

This is role playing. I am your new boss. I am in charge of production at ABC Beverage and you are a team of data scientists reporting to me. My leadership has told me that new regulations are requiring us to understand our manufacturing process, the predictive factors and be able to report to them our predictive model of PH. Please use the historical data set I am providing. Build and report the factors in BOTH a technical and non-technical report. I like to use Word and Excel. Please provide your non-technical report in a business friendly readable document and your predictions in an Excel readable format. The technical report should show clearly the models you tested and how you selected your final approach. Please submit both RPubs links and .rmd files or other readable formats for technical and non-technical reports. Also submit the excel file showing the prediction of your models for pH.

---

## 2. Load Data 

Two files are provided for this project. The file `StudentData.csv` contains the data used to build the predictive models for <i>PH</i>. The file `StudentEvaluation.csv` contains the data used to evaluate the selected model. The <i>PH</i> column in this file has no data.

```{r}
student_data<-read.csv("https://raw.githubusercontent.com/Luz917/data624project2/master/StudentData.csv")
student_eval<-read.csv("https://raw.githubusercontent.com/Luz917/data624project2/master/StudentEvaluation.csv")
```

### 2.2. Summary of Student Data

The `Student Data` data set has 2,571 observations and 33 variables. 

The data set contains categorical, continuous, and discrete variables. The data set has some missing values for most of the variables. The response variable <i>PH</i> has 4 missing values. All the predictor variables have missing values except for <i>Pressure.Vacuum</i> and <i>Air.Pressurer</i>. The categorical variable, <i>Brand.Code</i> has 120 missing values. 

```{r}
#summary(student_data)
skim(student_data)
```

The variable <i>Brand.Code</i> has four different categories, and there are 120 observations with categories that are not known. 

```{r}
table(student_data$誰..Brand.Code)
```

### 2.3. Summary of Student Evaluation 

The `Student Evaluation` data has 267 observations with 33 variables. 

As you can see, the data set also has some missing values for most of the variables. The response variable, <i>PH</i>, has no value as this will be predicted by the selected model. The categorical variable, <i>Brand.Code</i>, has 4 missing values. 

```{r}
#summary(student_eval)
skim(student_eval)
```

The variable <i>Brand.Code</i> of the evaluation data set has four different categories and eight observations without a known category. 

```{r}
table(student_eval$誰..Brand.Code)
```

Doing a little cleanup of the variable name `i..Brand.Code` and simply renaming this to `Brand.Code`. 

```{r}
names(student_data)[names(student_data) == "誰..Brand.Code"] <- "Brand.Code"
names(student_eval)[names(student_eval) == "誰..Brand.Code"] <- "Brand.Code"
```

---

## 3.Data Exploration

### 3.x Disribution of Response Variable <i>PH</i> 

The distribution of the response variable <i>PH</i> is approximately normal with some degree of skewness to the left. The mean <i>PH</i> value is 8.5.

```{r}
plot_histogram(student_data$PH)
```

### 3.1. Distribution of Predictors

Below shows the distribution of the numeric predictors. 

```{r}
plot_histogram((student_data[-c(26)]))
```


### 3.2. Pairs

Below is a pairwise scatter plots of each of the 32 numeric variables. The upper triangular section shows the correlations coefficients between the pairs of variables. 

For a larger version of this plot, click here. 


```{r fig.height=20, fig.width=20}
pairs.panels(student_data[1:32])
```

### 3.3. Box Plot


```{r fig.height=10, fig.width=10, message=FALSE, warning=FALSE}
ggplot(stack(student_data), aes(x= ind, y = values)) + 
  geom_boxplot(outlier.colour="green", outlier.shape=1, outlier.size=2,aes(fill=ind)) +
  theme_minimal()+
  coord_flip() 
```






### 3.4. Missing Data 

```{r fig.height=5}
plot_missing(student_data)
```



## 4. Data Preparation 

### Prepare and Create Dummy Variables of Brand.Code

```{r}
# student_data
Brand.A <- ifelse(student_data$Brand.Code  == 'A', 1, 0)
Brand.B <- ifelse(student_data$Brand.Code  == 'B', 1, 0)
Brand.C <- ifelse(student_data$Brand.Code  == 'C', 1, 0)
Brand.D <- ifelse(student_data$Brand.Code  == 'D', 1, 0)
student_data <- subset(student_data, select = -c(Brand.Code))

# student_eval
Brand.A.t <- ifelse(student_eval$Brand.Code  == 'A', 1, 0)
Brand.B.t <- ifelse(student_eval$Brand.Code  == 'B', 1, 0)
Brand.C.t <- ifelse(student_eval$Brand.Code == 'C', 1, 0)
Brand.D.t <- ifelse(student_eval$Brand.Code  == 'D', 1, 0)
student_eval <- subset(student_eval, select = -c(Brand.Code))


# create dummy columns 
student_data$Brand.A <- Brand.A
student_data$Brand.B <- Brand.B
student_data$Brand.C <- Brand.C
student_data$Brand.D <- Brand.D

student_eval$Brand.A <- Brand.A.t
student_eval$Brand.B <- Brand.B.t
student_eval$Brand.C <- Brand.C.t
student_eval$Brand.D <- Brand.D.t
```


Impute Data and Deal with Normality and NearZero 

```{r}
# pre-processing - combine all steps
prep <- preProcess(student_data, 
                   method = c("knnImpute", "center", "scale", "nzv"), k = 10)

student_data <- predict(prep, student_data)
student_eval <- predict(prep, student_eval)
```


```{r}
# Train set
highcor = findCorrelation(cor(student_data), 0.85)

student_data = student_data[, -highcor]
```

  


























